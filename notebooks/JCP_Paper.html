<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grid publication examples &mdash; grid  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/override.css" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            grid
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#downloading-code">Downloading Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id1">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#building-documentation">Building Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../onedgrids.html">One-Dimensional Grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="../radial_transf.html">Radial Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conventions.html#spherical-coordinates">Spherical Coordinates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conventions.html#spherical-harmonics">Spherical Harmonics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../conventions.html#ordering">Ordering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../conventions.html#angular-grids">Angular Grids</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../conventions.html#nested-grids">Nested Grids</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#One-Dimensional-Grids">One-Dimensional Grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#Angular-Grids">Angular Grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#Atomic-Grid">Atomic Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#Molecular-Grid">Molecular Grid</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#Visualize-3D-Grid-Points">Visualize 3D Grid Points</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#Integrate-Electron-Density-on-the-Grid">Integrate Electron Density on the Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#Interpolate-Electron-Density-on-the-Grid">Interpolate Electron Density on the Grid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#Check-Interpolation-Accuracy">Check Interpolation Accuracy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#Differentiate-Electron-Density-on-the-Grid">Differentiate Electron Density on the Grid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#Check-interpolated-derivative-accuracy">Check interpolated derivative accuracy</a></li>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#Graphical-comparisons-of-the-accuracy">Graphical comparisons of the accuracy</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="one_dimensional_grids.html">One-Dimensional Grids</a><ul>
<li class="toctree-l2"><a class="reference internal" href="one_dimensional_grids.html#Example:-Visualize-One-Dimensional-Grid-Points">Example: Visualize One-Dimensional Grid Points</a></li>
<li class="toctree-l2"><a class="reference internal" href="one_dimensional_grids.html#Example:-Integration-of-One-Variable-Function-on-[-1,-1]">Example: Integration of One-Variable Function on <span class="math notranslate nohighlight">\([-1, 1]\)</span></a><ul>
<li class="toctree-l3"><a class="reference internal" href="one_dimensional_grids.html#Radial-Grid:-Transformation-of-1D-Integration-Intervals">Radial Grid: Transformation of 1D-Integration Intervals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="one_dimensional_grids.html#Visualize-Radial-Grid-Points">Visualize Radial Grid Points</a></li>
<li class="toctree-l2"><a class="reference internal" href="one_dimensional_grids.html#Example:-Integration-of-One-Variable-Function-on-[0,-\infty]">Example: Integration of One-Variable Function on <span class="math notranslate nohighlight">\([0, \infty]\)</span></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="angular_grid.html">Angular Grids</a><ul>
<li class="toctree-l2"><a class="reference internal" href="angular_grid.html#Initialization-of-Angular-Grids">Initialization of Angular Grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="angular_grid.html#Integral-of-Identity-Function">Integral of Identity Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="angular_grid.html#Integral-of-Spherical-Harmonic-Function">Integral of Spherical Harmonic Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="angular_grid.html#Spherical-Harmonics-Are-Orthonormal">Spherical Harmonics Are Orthonormal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="atom_grid_construction.html">Atom Grid Construction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="atom_grid_construction.html#Atomic-Grid-AtomGrid">Atomic Grid <code class="docutils literal notranslate"><span class="pre">AtomGrid</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="atom_grid_construction.html#Plot-AtomGrid-Points">Plot <code class="docutils literal notranslate"><span class="pre">AtomGrid</span></code> Points</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="atom_grid_construction.html#Pruned-Grids-AtomGrid.from_pruned">Pruned Grids <code class="docutils literal notranslate"><span class="pre">AtomGrid.from_pruned</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="atom_grid_construction.html#Preset-Grids-AtomGrid.from_preset">Preset Grids <code class="docutils literal notranslate"><span class="pre">AtomGrid.from_preset</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="atom_grid_construction.html#Multiple-Centered-AtomGrids">Multiple Centered AtomGrids</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="atom_grid.html">Atom Grid Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="atom_grid.html#Construct-Atomic-Grid">Construct Atomic Grid</a><ul>
<li class="toctree-l3"><a class="reference internal" href="atom_grid.html#Example:-Integrate-Electron-Density">Example: Integrate Electron Density</a></li>
<li class="toctree-l3"><a class="reference internal" href="atom_grid.html#Example:-Calculate-Radial-Electron-Density-Distribution">Example: Calculate Radial Electron Density Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="atom_grid.html#Example:-Calculate-Classical-Coulomb-Repulsion-Energy">Example: Calculate Classical Coulomb Repulsion Energy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="molecular_grid_construction.html">Molecular Grid Construction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="molecular_grid_construction.html#Molecular-Grid-Details">Molecular Grid Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="molecular_grid_construction.html#Construction-of-Molecular-Grid">Construction of Molecular Grid</a><ul>
<li class="toctree-l3"><a class="reference internal" href="molecular_grid_construction.html#Constructor">Constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="molecular_grid_construction.html#from_preset-method">from_preset method</a></li>
<li class="toctree-l3"><a class="reference internal" href="molecular_grid_construction.html#from_size-method">from_size method</a></li>
<li class="toctree-l3"><a class="reference internal" href="molecular_grid_construction.html#from_pruned-method">from_pruned method</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="molecular_grid.html">Molecular Grid Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="molecular_grid.html#Integration">Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="molecular_grid.html#Example:-Electron-Density">Example: Electron Density</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="molecular_grid.html#Local-Properties">Local Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="molecular_grid.html#Interpolation">Interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="molecular_grid.html#Derivative-Interpolation">Derivative Interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="molecular_grid.html#Solving-Poisson-Equation">Solving Poisson Equation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cubic_grid.html">Cubic Grids</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cubic_grid.html#Tensor-1D-Grids">Tensor 1D Grids</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cubic_grid.html#Interpolation">Interpolation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cubic_grid.html#Uniform-Grid">Uniform Grid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interpolation_poisson.html">Interpolation and Solving Poisson’s Equation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="interpolation_poisson.html#Details">Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="interpolation_poisson.html#Example:-Unit-charge-distribution">Example: Unit-charge distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="interpolation_poisson.html#Solving-Poisson-Equation">Solving Poisson Equation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="multipole_moments.html">Multipole Moments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyapi/modules.html">grid</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pyapi/grid.html">grid package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pyapi/grid.html#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.angular.html">grid.angular module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.atomgrid.html">grid.atomgrid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.basegrid.html">grid.basegrid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.becke.html">grid.becke module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.cubic.html">grid.cubic module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.hirshfeld.html">grid.hirshfeld module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.molgrid.html">grid.molgrid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.ode.html">grid.ode module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.onedgrid.html">grid.onedgrid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.periodicgrid.html">grid.periodicgrid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.poisson.html">grid.poisson module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.rtransform.html">grid.rtransform module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pyapi/grid.utils.html">grid.utils module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../pyapi/grid.html#module-grid">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">grid</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Grid publication examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/JCP_Paper.ipynb" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></p>
<div class="section" id="Grid-publication-examples">
<h1>Grid publication examples<a class="headerlink" href="#Grid-publication-examples" title="Permalink to this heading"></a></h1>
<p>This notebook provides the examples of the use of <code class="docutils literal notranslate"><span class="pre">`qc-grid</span></code> &lt;<a class="reference external" href="https://grid.qcdevs.org/index.html">https://grid.qcdevs.org/index.html</a>&gt;`__ provided in the publication article.</p>
<div class="section" id="Install-dependencies-and-download-data">
<h2>Install dependencies and download data<a class="headerlink" href="#Install-dependencies-and-download-data" title="Permalink to this heading"></a></h2>
<p>This notebook requires several dependencies and data. The next cell will install the required dependencies if they are not already installed. It will also download the data required for the examples if it is not already downloaded.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>! python -m pip install numpy
! python -m pip install matplotlib
! python -m pip install scipy
! python -m pip install urllib3
! python -m pip install git+https://github.com/theochem/grid.git
! python -m pip install git+https://github.com/theochem/iodata.git
! python -m pip install git+https://github.com/maximilianvz/gbasis.git@address_issue_113

import os
from urllib.request import urlretrieve

# download the required data files
file_path = &quot;ch2o_q+0.fchk&quot;
if not os.path.isfile(file_path):
    url = &quot;https://github.com/theochem/grid/blob/master/doc/notebooks/ch2o_q%2B0.fchk?raw=true&quot;
    urlretrieve(url, file_path)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Grid-Construction-and-Integration">
<h2>Grid Construction and Integration<a class="headerlink" href="#Grid-Construction-and-Integration" title="Permalink to this heading"></a></h2>
<div class="section" id="1.-Radial-Grids:-One-Dimensional-Grids-and-Radial-Transformation">
<h3>1. Radial Grids: One-Dimensional Grids and Radial Transformation<a class="headerlink" href="#1.-Radial-Grids:-One-Dimensional-Grids-and-Radial-Transformation" title="Permalink to this heading"></a></h3>
<p>The following example shows how to build a radial grid by combining a one-dimensional grid (e.g., Gauss-Chebyshev Type 2) and a radial transformation (e.g., Becke transformation).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
from grid.onedgrid import GaussChebyshevType2
from grid.rtransform import BeckeRTransform

# Generate 1D grid on [-1, 1] interval
oned = GaussChebyshevType2(30)
print(&quot;Number of 1D grid points: &quot;, oned.size)   # outputs 30
print(&quot;Domain of 1D grid: &quot;, oned.domain)        # outputs (-1, 1)

# Transform 1D grid using Becke transformation
rgrid = BeckeRTransform(1.e-4, 1.5).transform_1d_grid(oned)

# Integrate Gaussian s-function from 0 to infinity
integral = rgrid.integrate(np.exp(-0.5 * rgrid.points**2))
print(&quot;Integral of Gaussian s-function: &quot;, integral)   # outputs sqrt(pi/2)
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.-Angular-Grids">
<h3>2. Angular Grids<a class="headerlink" href="#2.-Angular-Grids" title="Permalink to this heading"></a></h3>
<p>The following example shows construct and integrate over an angular grid.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
from grid import AngularGrid

# Make an instance of AngularGrid given a Lebedev-Laikov grid size
g = AngularGrid(size=140, use_spherical=False)
print(&quot;Number of angular grid points: &quot;, g.size)   # outputs 146
print(&quot;Shape of angular grid points: &quot;, g.points.shape)   # outputs (146, 3)
print(&quot;Shape of angular grid weights: &quot;, g.weights.shape) # outputs (146,)

# Confirm that angular grid points are on the unit sphere
norm = np.linalg.norm(g.points, axis=1)
print(&quot;Norm of the grid points is all one:&quot;, np.all(np.abs(norm - 1.0) &lt; 1e-8))

# Evaluate surface area of the unit sphere,
# i.e., integrate constant function 1
integral = g.integrate(np.ones(g.size))
print(&quot;Integral of constant function 1 over the sphere: &quot;, integral)   # 4*pi
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.-Atomic-Grid">
<h3>3. Atomic Grid<a class="headerlink" href="#3.-Atomic-Grid" title="Permalink to this heading"></a></h3>
<p>The following example shows three ways to construct an atomic grid.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from grid.atomgrid import AtomGrid

# Option 1: using radial grid and degrees of Lebedev-Laikov angular grid
atgrid = AtomGrid(rgrid, degrees=[11])
print(&quot;Number of atomic grid points: &quot;, atgrid.size) # outputs 1500

# Option 2: using radial grid and  atomic radius &amp; sectors
atgrid = AtomGrid.from_pruned(
    rgrid, radius=0.5, sectors_r=[0.5, 1.0, 1.5], sectors_degree=[3, 7, 5, 3]
)
print(&quot;Number of atomic grid points: &quot;, atgrid.size) # outputs 264

# Option 3: using radial grid, atomic number, and preset
atgrid = AtomGrid.from_preset(atnum=1, preset=&quot;coarse&quot;, rgrid=rgrid)
print(&quot;Number of atomic grid points: &quot;, atgrid.size) # outputs 1036
</pre></div>
</div>
</div>
</div>
<div class="section" id="4.-Molecular-Grid">
<h3>4. Molecular Grid<a class="headerlink" href="#4.-Molecular-Grid" title="Permalink to this heading"></a></h3>
<p>A molecular grid is constructed by combining atomic grids centered at each atom. A molecular grid needs to use atoms in molecules (AIM) weights for achieving a proper integration over the molecular grid. The following example shows how to construct a molecular grid and integrate over it.</p>
<div class="section" id="Provide-data-needed-for-molecular-grid-construction">
<h4>Provide data needed for molecular grid construction<a class="headerlink" href="#Provide-data-needed-for-molecular-grid-construction" title="Permalink to this heading"></a></h4>
<p>Fist, we need the data needed for molecular grid construction, this includes the molecular geometry, the atomic numbers and for testing purpose, a way to get the function values at the grid points. In this example, we use formaldehyde as the molecule and as function values its electron density.</p>
<div class="section" id="Select-the-AIM-weights-scheme">
<h5>Select the AIM weights scheme<a class="headerlink" href="#Select-the-AIM-weights-scheme" title="Permalink to this heading"></a></h5>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from grid.becke import BeckeWeights

# Make an instance of BeckeWeights class
aim_weights = BeckeWeights(radii=None, order=3)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-formaldehyde-molecule-data-(molecular-geometry,-nuclear-charges-and-atomic-coordinates)">
<h5>Load formaldehyde molecule data (molecular geometry, nuclear charges and atomic coordinates)<a class="headerlink" href="#Load-formaldehyde-molecule-data-(molecular-geometry,-nuclear-charges-and-atomic-coordinates)" title="Permalink to this heading"></a></h5>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from iodata import load_one

# Load formatted-checkpoint file of formaldehyde molecule. Source:
# https://github.com/theochem/grid/blob/master/doc/notebooks/ch2o_q%2B0.fchk
mol = load_one(&quot;ch2o_q+0.fchk&quot;)

# Get atomic numbers, core numbers, and Cartesian coordinates
atnums, atcharges, atcoords = mol.atnums, mol.atcorenums, mol.atcoords

print(&quot;Atomic Numbers: &quot;, atnums)
print(&quot;Atomic Core Charges: &quot;, atcharges)
print(&quot;Atomic Coordinates: &quot;, atcoords)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Construct-the-molecular-grid">
<h4>Construct the molecular grid<a class="headerlink" href="#Construct-the-molecular-grid" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><strong>From a set of atomic grids (one for each atom)</strong></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from grid.molgrid import MolGrid

# Option 1: Construct a molecular grid from atomic grids
atgrids = [
    AtomGrid(rgrid, degrees=[51], center=atcoords[0]),  # for oxygen
    AtomGrid(rgrid, degrees=[25], center=atcoords[1]),  # For carbon
    AtomGrid(rgrid, degrees=[10], center=atcoords[2]),  # for hydrogen 1
    AtomGrid(rgrid, degrees=[10], center=atcoords[3]),   # for hydrogen 2
]
molgrid = MolGrid(atnums, atgrids, aim_weights, store=True)

print(&quot;Number molecular grid points: &quot;, molgrid.size)   # outputs 39120
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><strong>Using predefined pruned grids corresponding to each nucleus</strong></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Option 2: Construct a molecular grid from predefined pruned angular grids
molgrid = MolGrid.from_preset(
    atnums, atcoords, preset=&quot;fine&quot;, rgrid=rgrid, aim_weights=aim_weights, store=True
)

print(&quot;Number molecular grid points: &quot;, molgrid.size)   # outputs 9892
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><strong>From the size of the angular grid</strong></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Option 3: Construct a molecular grid given size (40) of the angular grid
molgrid = MolGrid.from_size(
    atnums, atcoords, 40, rgrid, aim_weights, store=True
)

print(&quot;Number molecular grid points: &quot;, molgrid.size)   # outputs 6000
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><strong>From radial sectors and angular degrees associated with each sector</strong></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Option 4: Construct a molecular grid from user-defined pruned grids
sectors_r = [
    [0.25, 1.0, 1.5],   # for oxygen
    [0.50, 1.0, 1.5],   # for carbon
    [1.0],   # for hydrogen
    [1.0],   # for hydrogen
]
sectors_deg = [
    [10, 15, 25, 10],   # for oxygen
    [5, 10, 20, 10],   # for carbon
    [5, 10],   # for hydrogen
    [5, 10],   # for hydrogen
]
radius = 1.0
molgrid = MolGrid.from_pruned(
    atnums, atcoords, radius, sectors_r, rgrid, aim_weights, sectors_deg, store=True
)

print(&quot;Number molecular grid points: &quot;, molgrid.size)   # outputs 5664
</pre></div>
</div>
</div>
</div>
<div class="section" id="Integrate-molecular-properties-over-the-molecular-grid">
<h4>Integrate molecular properties over the molecular grid<a class="headerlink" href="#Integrate-molecular-properties-over-the-molecular-grid" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from gbasis.wrappers import from_iodata
from gbasis.evals.density import evaluate_density

# Evaluate the electron density in the grid points
basis = from_iodata(mol)
rdm = mol.one_rdms[&quot;scf&quot;]
rho = evaluate_density(rdm, basis, molgrid.points)

print(&quot;Integral of electron density: &quot;, molgrid.integrate(rho)) # outputs 16.00
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="5.-Cubic-Grids">
<h3>5. Cubic Grids<a class="headerlink" href="#5.-Cubic-Grids" title="Permalink to this heading"></a></h3>
<div class="section" id="Construct-uniform-cubic-grid-from-three-axes,-the-corresponding-step-sizes,-the-origin,-and-the-shape-(number-of-steps-in-each-axis)">
<h4>Construct uniform cubic grid from three axes, the corresponding step-sizes, the origin, and the shape (number of steps in each axis)<a class="headerlink" href="#Construct-uniform-cubic-grid-from-three-axes,-the-corresponding-step-sizes,-the-origin,-and-the-shape-(number-of-steps-in-each-axis)" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
from grid import UniformGrid

# Make 3D cubic grid centered at the origin with points 0.01 units apart
origin = np.array([0., 0., 0.])
axes = np.array([[0.01, 0., 0.], [0., 0.01, 0.], [0., 0., 0.01]])
shape = np.array([50, 50, 50])
g = UniformGrid(origin, axes, shape, weight=&quot;Trapezoid&quot;)

print(&quot;Number of cubic grid points: &quot;, g.size)   # outputs 125000
</pre></div>
</div>
</div>
</div>
<div class="section" id="Construct-a-uniform-cubic-grid-from-molecule-specifications">
<h4>Construct a uniform cubic grid from molecule specifications<a class="headerlink" href="#Construct-a-uniform-cubic-grid-from-molecule-specifications" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Construct a cubic grid with additional padding of 5
# and points 0.2 units apart
g = UniformGrid.from_molecule(
    atnums, atcoords, spacing=0.2, extension=5.0, rotate=True
)

print(&quot;Number of cubic grid points: &quot;, g.size) # outputs 232356
</pre></div>
</div>
</div>
</div>
<div class="section" id="Construct-non-uniform-cubic-grid-from-three-one-dimensional-(their-tensor-product)">
<h4>Construct non-uniform cubic grid from three one-dimensional (their tensor product)<a class="headerlink" href="#Construct-non-uniform-cubic-grid-from-three-one-dimensional-(their-tensor-product)" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from grid import GaussChebyshevType2, GaussLegendre, Tensor1DGrids

# Make instances of 1D grids
oned1 = GaussChebyshevType2(30)
oned2 = GaussLegendre(20)
oned3 = GaussLegendre(30)

# Make Tensor1DGrids grid by combining 1D grids
g = Tensor1DGrids(oned1, oned2, oned3)

print(&quot;cubic grid # of points: &quot;, g.size)      # outputs 18000
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Interpolation-and-Differentiation:">
<h2>Interpolation and Differentiation:<a class="headerlink" href="#Interpolation-and-Differentiation:" title="Permalink to this heading"></a></h2>
<p>The following example interpolates the electron density in the plane containing the formaldehyde.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np

# Sample 100 points uniformly along x and y axes
x_vals = np.linspace(-4, 4, 100)
y_vals = x_vals

# Sample 3D points uniformly in the molecular xy-plane (z=0)
x_vals, y_vals = np.meshgrid(x_vals, y_vals)
x_vals, y_vals = x_vals.flatten(), y_vals.flatten()
z_vals = np.zeros_like(x_vals)
points = np.array([x_vals, y_vals, z_vals]).T # interpolation requires 3D points

# Interpolate electron density in the xy-plane
func_interpolation = molgrid.interpolate(rho)
rho_inter = func_interpolation(points=points)

# Compute expected electron density using GBasis
rho_expected = evaluate_density(rdm, basis, points)

# Compare interpolated and expected electron density
max_error = np.max(abs(rho_inter - rho_expected))
print(&quot;Maximum interpolation error: &quot;, max_error) # outputs 0.219
</pre></div>
</div>
</div>
<p>Compute gradient from the interpolated electron density.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Compute the gradient at the interpolated points
grad_rho_inter = func_interpolation(points=points, deriv=1)
</pre></div>
</div>
</div>
<p>(optional) Code for plotting the electron density in fromaldehyde plane.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt

fig = plt.figure(figsize=(8, 6))
ax1 = fig.add_subplot(111)

# Plot the interpolated electron density as a 2D heatmap with specified color scale limits
heatmap = ax1.imshow(rho_inter.reshape(100,100), cmap=&quot;viridis&quot;, interpolation=&quot;none&quot;, extent=[-4, 4, -4, 4], vmin=0, vmax=0.8)
cbar = plt.colorbar(heatmap, ax=ax1, label=&quot;Electron Density&quot;)
cbar.ax.tick_params(labelsize=14)
cbar.ax.set_ylabel(&quot;Electron Density&quot;, fontsize=14)

# Add symbols to the corresponding coordinates
xy_coords = mol.atcoords[:, :2]

symbols = [&#39;O&#39;, &#39;C&#39;, &#39;H&#39;, &#39;H&#39;]

for coord, symbol in zip(xy_coords, symbols):
    ax1.text(coord[0], coord[1], symbol, color=&#39;red&#39;, ha=&#39;center&#39;, va=&#39;center&#39;, fontsize=14,fontweight=&#39;bold&#39;)

ax1.tick_params(axis=&#39;both&#39;, which=&#39;both&#39;, labelsize=14)
# Adjust the limits to fit your data and set labels and title
ax1.set_xlim((-4, 4))
ax1.set_ylim((-4, 4))
ax1.set_xlabel(&quot;X&quot;, fontsize=14)
ax1.set_ylabel(&quot;Y&quot;, fontsize=14)
ax1.set_title(&quot;Interpolated Electron density for formaldehyde on the molecule plane&quot;)
plt.show()
<br/></pre></div>
</div>
</div>
</div>
<div class="section" id="Solving-Poisson-Equation">
<h2>Solving Poisson Equation<a class="headerlink" href="#Solving-Poisson-Equation" title="Permalink to this heading"></a></h2>
<p>The following example solves the Poisson equation on an atomic grid for unit-charge distribution:</p>
<dl class="simple">
<dt>:nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{equation}</dt><dd><p>rho(r, theta, phi) = bigg( frac{alpha}{pi} bigg)^{1.5} e^{-alpha r_A^2},</p>
</dd>
</dl>
<p>end{equation}` where <span class="math notranslate nohighlight">\(\alpha = 0.25\)</span> and <span class="math notranslate nohighlight">\(r_A\)</span> is the radius centered at the coordinate <span class="math notranslate nohighlight">\([0, 1, 0]\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
from grid.poisson import solve_poisson_bvp
from grid.rtransform import BeckeRTransform, InverseRTransform
from scipy.special import erf

center = np.array([0, 1, 0])

def charge_distribution(x, alpha=0.25):
    r = np.linalg.norm(x - center, axis=1)
    return (alpha / np.pi) ** (3.0 / 2.0) * np.exp(-alpha * r**2.0)

def actual_potential(x, alpha=0.25):
    r_PC = np.linalg.norm(x - center, axis=1)
    desired = erf(np.sqrt(alpha) * r_PC) / r_PC
    desired[r_PC == 0.0] = 0.0
    return desired

# define atomic grid at the center of the potential
btf = BeckeRTransform(1.e-4, 1.5)
atgrid = AtomGrid.from_preset(atnum=1, preset=&quot;fine&quot;, rgrid=rgrid, center=center)

# Evaluate unit-charge density on atomic grid points
func_vals = charge_distribution(atgrid.points)

# Solve for the potential and evaluate it on atomic grid points
potential = solve_poisson_bvp(
        atgrid,
        func_vals,
        InverseRTransform(btf),
        include_origin=True,
        remove_large_pts=7.0,
)
potential_values = potential(atgrid.points)

# Calculate the error between actual and solved potential
err = np.abs(actual_potential(atgrid.points) - potential_values)
print(&quot;Mean error in potential: &quot;)
print(f&quot;Max: {np.max(err)}, Mean: {np.mean(err)}, Std: {np.std(err)}&quot;)
# outputs Max: 1.932e-04, Mean: 5.998e-05, Std: 2.809e-05
</pre></div>
</div>
</div>
</div>
<div class="section" id="Multipole-Moments">
<h2>Multipole Moments<a class="headerlink" href="#Multipole-Moments" title="Permalink to this heading"></a></h2>
<p>The following example illustrates how to use Grid’s moment function to calculate the dipole moment <span class="math notranslate nohighlight">\(\mu\)</span> of formaldehyde.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Dictionary of isotopic mass
isotopic_masses = {
    1: 1.007825,
    6: 12.0,
    8: 15.994915
}

# Calculate the center of mass of the molecule
masses = np.array([isotopic_masses[atnum] for atnum in atnums])
center = np.array([np.sum(atcoords * masses[:, None], axis=0) / np.sum(masses)])

# Calculate the Cartesian moments of the electron density
integrals, orders = molgrid.moments(
    1, center, rho, type_mom=&quot;cartesian&quot;, return_orders=True
)

result = -integrals
# Calculate first term: sum_i Z_i (R_i - R_c)
for i, atcoord in enumerate(atcoords):
    # calculate Z_a (X_a - X_c)**{n_x} (Y_a - Y_c)**{n_y} (Z_a - Z_c)**{n_z}
    cent_pts_with_order = (atcoord - center) ** orders[:, None]
    cent_pts_with_order = np.prod(cent_pts_with_order, axis=2)
    result += atcharges[i] * cent_pts_with_order

dipole_moment = np.ravel(result[1:])
print(&quot;Dipole moment: &quot;, dipole_moment)
# ouputs -9.398e-01 -4.076e-04 -6.545e-06
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, QC-Devs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>